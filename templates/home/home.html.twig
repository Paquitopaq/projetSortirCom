{% extends 'base.html.twig' %}

{% block title %}Accueil | BougeTonCrew{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/home.css') }}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block body %}
    <!-- Hero Section avec recherche intégrée -->
    <section class="hero-section" id="hero-section">
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">Bouge ton Crew !</h1>
                <p class="hero-subtitle">Découvrez les meilleures sorties et événements près de chez vous</p>

                <!-- Barre de recherche dans le hero -->
                <div class="hero-search-section">
                    <span class="hero-search-label">Recherchez votre prochaine sortie</span>

                    <form action="{{ path('app_sortie') }}" method="get">
                        <div class="search-container">
                            <!-- Recherche par nom -->
                            <div class="search-section">
                                <div class="search-label">
                                    <i class="fas fa-search"></i> Nom de la sortie
                                </div>
                                <input type="text" name="nom_sortie" class="search-input"
                                       placeholder="Rechercher une sortie...">
                            </div>

                            <!-- Dates -->
                            <div class="search-section">
                                <div class="search-label">
                                    <i class="fas fa-calendar-alt"></i> Date de début
                                </div>
                                <input type="text" name="date_debut" id="date-debut" class="search-input"
                                       placeholder="À partir du..." readonly>
                            </div>

                            <div class="search-section">
                                <div class="search-label">
                                    <i class="fas fa-calendar-check"></i> Date de fin
                                </div>
                                <input type="text" name="date_fin" id="date-fin" class="search-input"
                                       placeholder="Jusqu'au..." readonly>
                            </div>

                            <!-- Bouton de recherche -->
                            <button type="submit" class="search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>

                        <!-- Filtres avancés (checkboxes) -->
                        <div class="search-filters">
                            <label class="filter-checkbox">
                                <input type="checkbox" name="organisateur" value="1">
                                <span><i class="fas fa-user-tie"></i> Sorties que j'organise</span>
                            </label>

                            <label class="filter-checkbox">
                                <input type="checkbox" name="inscrit" value="1">
                                <span><i class="fas fa-check-circle"></i> Sorties auxquelles je participe</span>
                            </label>

                            <label class="filter-checkbox">
                                <input type="checkbox" name="non_inscrit" value="1">
                                <span><i class="fas fa-times-circle"></i> Sorties auxquelles je ne participe pas</span>
                            </label>

                            <label class="filter-checkbox">
                                <input type="checkbox" name="passees" value="1">
                                <span><i class="fas fa-history"></i> Sorties passées</span>
                            </label>
                        </div>
                    </form>
                </div>
            </div>

            <div class="hero-image">
                <img src="{{ asset('assets/images/niort-fond.jpg') }}" alt="Niort">
            </div>
        </div>
    </section>

    <!-- Sorties Section -->
    <section class="sorties-section">
        <div class="section-header">
            <h2 class="section-title">Prochaines sorties</h2>
            <a href="{{ path('app_sortie') }}" class="see-all">
                Voir tout <i class="fas fa-arrow-right"></i>
            </a>
        </div>

        <div class="sorties-grid">
            {% for sortie in sorties|slice(0, 6) %}
                <div class="sortie-card">
                    <div class="sortie-image">
                        <img src="https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=400&h=300&fit=crop" alt="{{ sortie.nom }}">
                        <span class="sortie-badge">{{ sortie.etat.value }}</span>
                    </div>
                    <div class="sortie-content">
                        <h3 class="sortie-title">{{ sortie.nom }}</h3>
                        <div class="sortie-meta">
                            <div class="sortie-date">
                                <i class="fas fa-calendar"></i>
                                {% if sortie.dateHeureDebut %}
                                    {{ sortie.dateHeureDebut|date('d/m/Y à H:i') }}
                                {% else %}
                                    Date à définir
                                {% endif %}
                            </div>
                            <div class="sortie-lieu">
                                <i class="fas fa-map-marker-alt"></i>
                                {{ sortie.lieu.nom ?? 'Lieu à définir' }}
                            </div>
                        </div>
                        <div class="sortie-footer">
                            <div class="sortie-info">
                                <i class="fas fa-clock"></i>
                                <span class="sortie-duree">{{ sortie.duree }} min</span>
                            </div>
                            <a href="{{ path('sortie_detail', {'id': sortie.id}) }}" class="btn-join">
                                <i class="fas fa-eye"></i> Voir détails
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="no-sorties">
                    <i class="fas fa-inbox fa-4x"></i>
                    <h3>Aucune sortie disponible</h3>
                    <p>Soyez le premier à créer une sortie !</p>
                    <a href="{{ path('sortie_create') }}" class="btn-primary-large">
                        <i class="fas fa-plus-circle"></i> Créer une sortie
                    </a>
                </div>
            {% endfor %}
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="stats-container">
            <div class="stat-item">
                <i class="fas fa-calendar-check fa-3x"></i>
                <div class="stat-number">{{ sorties|length }}</div>
                <div class="stat-label">Sorties disponibles</div>
            </div>
            <div class="stat-item">
                <i class="fas fa-users fa-3x"></i>
                <div class="stat-number">500+</div>
                <div class="stat-label">Participants actifs</div>
            </div>
            <div class="stat-item">
                <i class="fas fa-user-tie fa-3x"></i>
                <div class="stat-number">50+</div>
                <div class="stat-label">Organisateurs</div>
            </div>
        </div>
    </section>
    {% include 'partials/_footer.html.twig' %}

{% endblock %}

{% block javascripts %}
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>

    <script>
        // Images de fond aléatoires pour le hero
        const heroImages = [
            '{{ asset("assets/images/niort-fond.jpg") }}',
            '{{ asset("assets/images/nantes.jpg") }}',
            '{{ asset("assets/images/quimper.webp") }}',
            '{{ asset("assets/images/rennes.jpg") }}',
        ];

        // Sélection aléatoire d'une image
        const randomImage = heroImages[Math.floor(Math.random() * heroImages.length)];
        const heroSection = document.getElementById('hero-section');
        heroSection.style.backgroundImage = `url('${randomImage}')`;
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Messages flash avec SweetAlert2
            {% for message in app.flashes('success') %}
            Swal.fire({
                icon: 'success',
                title: 'Succès !',
                text: '{{ message|escape('js') }}',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                toast: true,
                position: 'top-end',
                background: '#d4edda',
                color: '#155724',
                iconColor: '#28a745'
            });
            {% endfor %}

            {% for message in app.flashes('danger') %}
            Swal.fire({
                icon: 'error',
                title: 'Erreur',
                text: '{{ message|escape('js') }}',
                confirmButtonColor: '#dc3545',
                confirmButtonText: 'Compris'
            });
            {% endfor %}

            {% for message in app.flashes('warning') %}
            Swal.fire({
                icon: 'warning',
                title: 'Attention',
                text: '{{ message|escape('js') }}',
                confirmButtonColor: '#ffc107',
                confirmButtonText: 'OK'
            });
            {% endfor %}

            {% for message in app.flashes('info') %}
            Swal.fire({
                icon: 'info',
                title: 'Information',
                text: '{{ message|escape('js') }}',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                toast: true,
                position: 'top-end'
            });
            {% endfor %}

            // Initialisation Flatpickr pour date début
            const dateDebut = document.getElementById('date-debut');
            if (dateDebut) {
                flatpickr(dateDebut, {
                    dateFormat: "Y-m-d",
                    altInput: true,
                    altFormat: "d/m/Y",
                    locale: "fr",
                    minDate: "today"
                });
            }

            // Initialisation Flatpickr pour date fin
            const dateFin = document.getElementById('date-fin');
            if (dateFin) {
                flatpickr(dateFin, {
                    dateFormat: "Y-m-d",
                    altInput: true,
                    altFormat: "d/m/Y",
                    locale: "fr",
                    minDate: "today"
                });
            }
        });
    </script>
{% endblock %}