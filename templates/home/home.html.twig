{% extends 'base.html.twig' %}

{% block title %}Accueil | BougeTonCrew{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/home.css') }}">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
{% endblock %}

{% block body %}
    <!-- Barre de recherche -->
    <div class="search-bar">
        <form action="{{ path('app_sortie') }}" method="get">
            <div class="search-container">
                <div class="search-section" id="destination-section">
                    <div class="search-label">Destination</div>
                    <input type="text" name="destination" class="search-input" placeholder="Rechercher une destination">
                </div>
                <div class="search-section" id="dates-section">
                    <div class="search-label">Dates</div>
                    <input type="text" name="dates" class="search-input datepicker" placeholder="Quand ?" readonly>
                </div>
                <div class="search-section" id="type-section">
                    <div class="search-label">Type de service</div>
                    <input type="text" name="type" class="search-input" placeholder="Ajouter">
                </div>
                <button type="submit" class="search-btn">
                    <svg class="search-icon" viewBox="0 0 32 32" fill="currentColor">
                        <path d="M13 0c7.18 0 13 5.82 13 13 0 2.868-.929 5.519-2.502 7.669l7.916 7.917-2.828 2.828-7.917-7.916A12.942 12.942 0 0 1 13 26C5.82 26 0 20.18 0 13S5.82 0 13 0zm0 4a9 9 0 1 0 0 18 9 9 0 0 0 0-18z"/>
                    </svg>
                </button>
            </div>
        </form>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">Sortir à Niort</h1>
                <p class="hero-subtitle">Découvrez les meilleures sorties et événements près de chez vous</p>
                <div class="hero-buttons">
                    <a href="{{ path('app_sortie') }}" class="btn-primary-large">Explorer les sorties</a>
                    <a href="{{ path('sortie_create') }}" class="btn-secondary-large">Créer une sortie</a>
                </div>
            </div>
            <div class="hero-image">
                <img src="{{ asset('assets/images/niort-fond.jpg') }}" alt="Niort">
            </div>
        </div>
    </section>

    <!-- Sorties Section -->
    <section class="sorties-section">
        <div class="section-header">
            <h2 class="section-title">Prochaines sorties</h2>
            <a href="{{ path('app_sortie') }}" class="see-all">Voir tout →</a>
        </div>

        <div class="sorties-grid">
            {% for sortie in sorties|slice(0, 6) %}
                <div class="sortie-card">
                    <div class="sortie-image">
                        <img src="https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=400&h=300&fit=crop" alt="{{ sortie.nom }}">
                        <span class="sortie-badge">{{ sortie.etat.value }}</span>
                    </div>
                    <div class="sortie-content">
                        <h3 class="sortie-title">{{ sortie.nom }}</h3>
                        <div class="sortie-meta">
                            <div class="sortie-date">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                {% if sortie.dateHeureDebut %}
                                    {{ sortie.dateHeureDebut|date('d/m/Y à H:i') }}
                                {% else %}
                                    Date à définir
                                {% endif %}
                            </div>
                            <div class="sortie-lieu">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                                {{ sortie.lieu.nom ?? 'Lieu à définir' }}
                            </div>
                        </div>
                        <div class="sortie-footer">
                            <div class="sortie-info">
                                <span class="sortie-duree">Durée : {{ sortie.duree }} min</span>
                            </div>
                            <a href="{{ path('sortie_detail', {'id': sortie.id}) }}" class="btn-join">Voir détails</a>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="no-sorties">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <h3>Aucune sortie disponible</h3>
                    <p>Soyez le premier à créer une sortie !</p>
                    <a href="{{ path('sortie_create') }}" class="btn-primary-large">Créer une sortie</a>
                </div>
            {% endfor %}
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-number">{{ sorties|length }}</div>
                <div class="stat-label">Sorties disponibles</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">500+</div>
                <div class="stat-label">Participants actifs</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">50+</div>
                <div class="stat-label">Organisateurs</div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>BougeTonCrew</h4>
                <p>La plateforme pour organiser et participer à des sorties près de chez vous.</p>
            </div>
            <div class="footer-section">
                <h4>Navigation</h4>
                <a href="{{ path('app_home') }}">Accueil</a>
                <a href="{{ path('app_sortie') }}">Sorties</a>
                <a href="{{ path('sortie_create') }}">Créer une sortie</a>
            </div>
            <div class="footer-section">
                <h4>Compte</h4>
                {% if app.user %}
                    {# TODO: <a href="{{ path('profile_index') }}">Mon profil</a> #}
                    {# <a href="{{ path('profile_edit') }}">Paramètres</a> #}
                {% else %}
                    <a href="{{ path('app_login') }}">Se connecter</a>
                    <a href="{{ path('app_register') }}">S'inscrire</a>
                {% endif %}
            </div>
            <div class="footer-section">
                <h4>Légal</h4>
                <a href="#">Mentions légales</a>
                <a href="#">CGU</a>
                <a href="#">Politique de confidentialité</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; {{ "now"|date("Y") }} BougeTonCrew - Tous droits réservés</p>
        </div>
    </footer>
{% endblock %}

{% block javascripts %}
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- flatpickr JS + localisation FR -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>

    <script>
        // Gestion des messages flash avec SweetAlert2
        document.addEventListener('DOMContentLoaded', function() {
            // Messages de succès (toast en haut à droite)
            {% for message in app.flashes('success') %}
            Swal.fire({
                icon: 'success',
                title: 'Succès !',
                text: '{{ message|escape('js') }}',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                toast: true,
                position: 'top-end',
                background: '#d4edda',
                color: '#155724',
                iconColor: '#28a745'
            });
            {% endfor %}

            // Messages d'erreur (popup au centre)
            {% for message in app.flashes('danger') %}
            Swal.fire({
                icon: 'error',
                title: 'Erreur',
                text: '{{ message|escape('js') }}',
                confirmButtonColor: '#dc3545',
                confirmButtonText: 'Compris'
            });
            {% endfor %}

            // Messages d'avertissement
            {% for message in app.flashes('warning') %}
            Swal.fire({
                icon: 'warning',
                title: 'Attention',
                text: '{{ message|escape('js') }}',
                confirmButtonColor: '#ffc107',
                confirmButtonText: 'OK'
            });
            {% endfor %}

            // Messages d'information (toast en haut à droite)
            {% for message in app.flashes('info') %}
            Swal.fire({
                icon: 'info',
                title: 'Information',
                text: '{{ message|escape('js') }}',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                toast: true,
                position: 'top-end'
            });
            {% endfor %}

            // Initialisation de flatpickr
            const el = document.querySelector('.datepicker');
            if (el) {
                flatpickr(el, {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "d/m/Y à H:i",
                    time_24hr: true,
                    locale: "fr",
                });
            }
        });
    </script>
{% endblock %}